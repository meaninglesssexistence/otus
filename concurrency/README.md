# MemcLoad

Однопоточная версия `memc_load.py` переделана в более производительный вариант.
Для этого работа с memcached вынесена в отдельные потоки. По одному на каждый
memcached сервер. Для синхронизации обмена данными между парсером файлов в
главном потоке и отправителями данных на сервера memcached используются
примитивы `threading.Condition`.

## Использование

```
Usage: memc_load.py [options]

Options:
  -h, --help         show this help message and exit
  -t, --test
  -l LOG, --log=LOG
  --dry
  --pattern=PATTERN
  --idfa=IDFA
  --gaid=GAID
  --adid=ADID
  --dvid=DVID
```

### Боевой запуск

```
$ ./memc_load.py --pattern=*.tsv.gz --log=concurrency.log
```

### Тестовый запуск

```
$ ./memc_load.py --test
```

## Результаты

Для замеров времени работы обрабатывался один файл `20170929000000.tsv.gz`. Все
четыре memcached сервера были запущены на локальной машине. Между запусками
сервера перезагружались.

1. Точное время работы оригинальная версии программы не измерялось. Оно
   превысило 20 минут, после чего программы была прервана.

2. Однопоточная версия программы, но без создания нового подключения к серверу
   на каждую посылку данных отработала за ~800 секунд.

3. Многопоточная версия программы отработала за ~500 секунд.

4. Многопоточная версия программы с посылкой нескольких пар ключ/значеение за
   одиен раз отработала за ~500 секунд, но погтребовала существенно меньше
   оперативной памяти.
